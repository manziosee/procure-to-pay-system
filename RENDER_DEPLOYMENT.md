# ğŸš€ Render Deployment Guide

## ğŸ“‹ Pre-Deployment Checklist

âœ… **Backend Ready**:
- âœ… drf-spectacular configured for production
- âœ… Swagger UI accessible without authentication
- âœ… Production settings optimized
- âœ… Build script created
- âœ… Demo users auto-creation
- âœ… Gunicorn configured
- âœ… Health check endpoint

## ğŸ”§ Render Setup

### 1. Create New Web Service
1. Go to [Render Dashboard](https://dashboard.render.com)
2. Click "New" â†’ "Web Service"
3. Connect your GitHub repository
4. **Important**: Set root directory to `backend`
5. Select branch: `main`

### 2. Service Configuration
```yaml
Name: procure-to-pay-backend
Environment: Python 3
Region: Oregon (or closest to you)
Branch: main
Root Directory: backend
Build Command: ./build.sh
Start Command: gunicorn procure_to_pay.wsgi:application
```

### 3. Environment Variables

**Required Variables:**
```bash
DJANGO_SETTINGS_MODULE=procure_to_pay.settings.production
SECRET_KEY=<auto-generated-by-render>
DEBUG=False
DATABASE_URL=<your-render-postgresql-connection-string>
ALLOWED_HOSTS=<your-render-domain>.onrender.com,localhost
CORS_ALLOWED_ORIGINS=https://<your-frontend-domain>,http://localhost:3000
OPENAI_API_KEY=<your-openai-api-key>
```

**Optional Variables:**
```bash
REDIS_URL=<redis-connection-string>
FRONTEND_URL=https://<your-frontend-domain>
```

### 4. Render PostgreSQL Connection String
Use the DATABASE_URL provided by your Render PostgreSQL instance:
```
postgresql://username:password@hostname:port/database_name
```

## ğŸŒ Post-Deployment

### Verify Endpoints:
- **Health Check**: `https://<your-app>.onrender.com/health/`
- **Swagger UI**: `https://<your-app>.onrender.com/api/docs/`
- **ReDoc**: `https://<your-app>.onrender.com/api/redoc/`
- **API Schema**: `https://<your-app>.onrender.com/api/schema/`

### Test Authentication:
```bash
curl -X POST https://<your-app>.onrender.com/api/auth/login/ \
  -H "Content-Type: application/json" \
  -d '{"email": "staff1@example.com", "password": "password123"}'
```

## ğŸ” Troubleshooting

### Common Issues:

1. **Build Fails**:
   - Check `requirements.txt` is complete
   - Verify build script permissions: `chmod +x build.sh`

2. **Database Connection**:
   - Verify DATABASE_URL format
   - Check Render PostgreSQL connection limits
   - Ensure SSL mode is required

3. **Static Files**:
   - Render automatically serves static files
   - Check `STATIC_ROOT` in settings

4. **CORS Issues**:
   - Add your frontend domain to `CORS_ALLOWED_ORIGINS`
   - Include both HTTP and HTTPS versions

5. **Swagger Not Loading**:
   - Check `SERVE_PERMISSIONS` in SPECTACULAR_SETTINGS
   - Verify `/api/docs/` endpoint accessibility

## ğŸ“Š Monitoring

### Health Check
The `/health/` endpoint returns:
```json
{
  "status": "healthy",
  "service": "Procure-to-Pay Backend",
  "version": "1.0.0"
}
```

### Logs
Access logs via Render dashboard:
- Dashboard â†’ Your Service â†’ Logs

## ğŸ”„ Updates

To deploy updates:
1. Push changes to your GitHub repository
2. Render automatically rebuilds and deploys
3. Monitor deployment in Render dashboard

## ğŸ¯ Production URLs

After deployment, your API will be available at:
- **Base URL**: `https://<your-app>.onrender.com`
- **Swagger**: `https://<your-app>.onrender.com/api/docs/`
- **API Endpoints**: `https://<your-app>.onrender.com/api/...`

## ğŸ” Security Notes

- âœ… DEBUG=False in production
- âœ… SECRET_KEY auto-generated by Render
- âœ… HTTPS enforced by Render
- âœ… Database SSL required
- âœ… CORS properly configured
- âœ… Security headers enabled